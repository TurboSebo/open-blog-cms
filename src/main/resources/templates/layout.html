<!DOCTYPE html>
<html lang="pl" xmlns:th="http://www.thymeleaf.org">
<head th:fragment="head(title)">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${title}">Open Blog CMS</title>

    <!-- Wczesne zastosowanie motywu z localStorage, aby uniknac migniecia domyslnego motywu -->
    <script>
        (function() {
            var theme = null;
            try {
                if (window.localStorage) {
                    var raw = localStorage.getItem('obcms.theme');
                    if (raw) {
                        theme = JSON.parse(raw);
                    }
                }
            } catch (e) {
                try {
                    if (window.localStorage) {
                        localStorage.removeItem('obcms.theme');
                    }
                } catch (ignore) {}
            }

            var defaultTheme = {
                colorPrimary: '#3b82f6',
                colorHeaderBg: '#1e293b',
                colorAsideBg: '#1e293b',
                colorMainBg: 'transparent',
                colorSurface: '#1e293b',
                colorBodyBg: '#0f172a',
                colorText: '#e2e8f0'
            };

            var effective = theme || defaultTheme;
            try {
                var rootStyle = document.documentElement.style;
                if (effective.colorPrimary) rootStyle.setProperty('--c-primary', effective.colorPrimary);
                if (effective.colorHeaderBg) rootStyle.setProperty('--c-header-bg', effective.colorHeaderBg);
                if (effective.colorAsideBg) rootStyle.setProperty('--c-aside-bg', effective.colorAsideBg);
                if (effective.colorMainBg) rootStyle.setProperty('--c-main-bg', effective.colorMainBg);
                if (effective.colorSurface) rootStyle.setProperty('--c-surface', effective.colorSurface);
                if (effective.colorBodyBg) rootStyle.setProperty('--c-body-bg', effective.colorBodyBg);
                if (effective.colorText) rootStyle.setProperty('--c-body-fg', effective.colorText);
            } catch (e) {
                // jesli cos pojdzie nie tak, po prostu zostawiamy domyslne kolory z CSS
            }

            document.documentElement.classList.add('theme-ready');
        })();
    </script>
    <!-- Fontello -->
    <link rel="stylesheet" th:href="@{/css/fontello/css/fontello.css}">
    <!-- Main style -->
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body th:fragment="layout(title, content)">

<div id="container">
    <header>
        <a href="/" style="text-decoration: none; color: inherit; display:block;">
            <h1 th:text="${siteTitle} != null ? ${siteTitle} : 'Open Blog CMS'"
                th:style="${siteTitleAlign} == 'center' ? 'text-align:center;' : (${siteTitleAlign} == 'right' ? 'text-align:right;' : 'text-align:left;') + ' '"
                th:styleappend="(${siteTitleColor} != null ? 'color:' + ${siteTitleColor} + ';' : '') + (${siteTitleSize} != null ? 'font-size:' + ${siteTitleSize} + 'px;' : '')">
                Open Blog CMS
            </h1>
        </a>
    </header>

    <main>
        <aside>
            <nav>
                <h3>Menu</h3>
                <ul>
                    <li><a th:href="@{/}">Strona główna</a></li>
                    <li><a th:href="@{/about}">O blogu</a></li>
                    <li><a th:href="@{/archive}">Przeglądaj posty</a></li>


                    <span th:if="${session.currentUser != null}">
                        <a th:href="@{/logout}">Wyloguj</a>
                    </span>
                    <span th:if="${session.currentRole != null and session.currentRole >= 2}">
                        <a th:href="@{/admin}">Panel admina</a>
                    </span>
                </ul>

                <hr>

                <h3>O autorze</h3>
                <div style="display:flex; align-items:center; gap:12px; margin-bottom:8px;">
                    <div style="width:80px; height:80px; border-radius:8px; background:rgba(148,163,184,0.15); border:1px solid rgba(148,163,184,0.5); display:flex; align-items:center; justify-content:center; overflow:hidden;">
                        <span th:if="${#strings.isEmpty(authorAvatar)}" style="font-size:0.75rem; color:#94a3b8; text-align:center; padding:4px;">Autor</span>
                        <img th:if="${!#strings.isEmpty(authorAvatar)}" th:src="${authorAvatar}"
                             alt="Zdjęcie autora" style="width:100%; height:100%; object-fit:cover;">
                    </div>
                </div>

                <p th:utext="${aboutAuthor} != null ? ${aboutAuthor} : 'To jest prosty blog zbudowany na Spring Boot i czystym JavaScript.'">
                    To jest prosty blog zbudowany na Spring Boot i czystym JavaScript.
                </p>
            </nav>
        </aside>

        <!-- tutaj wchodzi treść konkretnej strony -->
        <article th:replace="${content}"></article>
    </main>

    <footer>
        <p>&copy; 2025 Open Blog CMS. Built with Spring Boot.</p>
    </footer>
</div>

<!-- Toast container -->
<div id="toast" class="toast hidden"></div>

<script th:src="@{/js/app.js}"></script>

</body>
</html>
