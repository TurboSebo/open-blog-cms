<!DOCTYPE html>
<html lang="pl" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Open Blog CMS</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>

<div id="container">
    <header>
        <a href="/" style="text-decoration: none; color: inherit;">
            <h1>Open Blog CMS</h1>
        </a>
    </header>

    <main>
        <aside>
            <nav>
                <h3>Menu</h3>
                <ul>
                    <li><a href="/">Strona główna</a></li>
                    <li><a href="/login">Zaloguj się</a></li>
                    <li><a href="/admin">Panel Admina</a></li>
                </ul>

                <hr>

                <h3>O autorze</h3>
                <p>To jest prosty blog zbudowany na Spring Boot i czystym JavaScript.</p>
            </nav>
        </aside>

        <article>
            <h2>Najnowsze wpisy</h2>

            <div id="blog-feed">
                <p class="muted">Ładowanie wpisów...</p>
            </div>
        </article>
    </main>

    <footer>
        <p>&copy; 2025 Open Blog CMS. Built with Spring Boot.</p>
    </footer>
</div>

<script th:src="@{/js/app.js}"></script>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        // Sprawdzamy, czy istnieje kontener na posty (żeby nie sypało błędami w panelu admina)
        const feedContainer = document.getElementById('blog-feed');

        if (feedContainer) {
            fetch('/api/posts') // Strzał do Twojego Backend-u
                .then(response => response.json())
                .then(posts => {
                    // Czyścimy napis "Ładowanie..."
                    feedContainer.innerHTML = '';

                    // Filtrujemy tylko opublikowane posty
                    const publishedPosts = posts.filter(p => p.published);

                    if (publishedPosts.length === 0) {
                        feedContainer.innerHTML = '<p>Brak opublikowanych wpisów.</p>';
                        return;
                    }

                    // Generujemy HTML dla każdego posta
                    publishedPosts.forEach(post => {
                        const postElement = document.createElement('section');
                        postElement.style.marginBottom = '40px';
                        postElement.style.borderBottom = '1px solid var(--c-border)';
                        postElement.style.paddingBottom = '20px';

                        // Formatowanie daty
                        const date = new Date(post.createdAt).toLocaleDateString('pl-PL');

                        postElement.innerHTML = `
                            <h3 style="margin-bottom: 10px; color: var(--c-primary);">${post.title}</h3>
                            <div class="muted" style="margin-bottom: 15px; font-size: 0.85rem;">
                                Dodano: ${date}
                            </div>
                            <div class="content">
                                ${post.content}
                            </div>
                        `;
                        feedContainer.appendChild(postElement);
                    });
                })
                .catch(err => {
                    console.error('Błąd pobierania postów:', err);
                    feedContainer.innerHTML = '<p style="color: red;">Nie udało się pobrać wpisów.</p>';
                });
        }
    });
</script>
<script>
    // Funkcja ładująca motyw z bazy danych
    (function loadTheme() {
        fetch('/api/theme')
            .then(res => res.json())
            .then(theme => {
                const root = document.documentElement.style;
                // Mapujemy pola z Javy na zmienne CSS
                if(theme.colorPrimary) root.setProperty('--c-primary', theme.colorPrimary);
                if(theme.colorHeaderBg) root.setProperty('--c-header-bg', theme.colorHeaderBg);
                if(theme.colorAsideBg) root.setProperty('--c-aside-bg', theme.colorAsideBg);
                if(theme.colorMainBg) root.setProperty('--c-main-bg', theme.colorMainBg);
                if(theme.colorSurface) root.setProperty('--c-surface', theme.colorSurface);
                if(theme.colorBodyBg) root.setProperty('--c-body-bg', theme.colorBodyBg);
                if(theme.colorText) root.setProperty('--c-body-fg', theme.colorText);
            })
            .catch(err => console.error('Nie udało się załadować motywu:', err));
    })();
</script>
</body>
</html>