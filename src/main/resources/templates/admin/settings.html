<!DOCTYPE html>
<html lang="pl" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layout :: head('Ustawienia treści - Open Blog CMS')}"></head>
<body th:replace="~{layout :: layout('Ustawienia treści - Open Blog CMS', ~{::article})}">

<article>
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2>Ustawienia treści</h2>
        <a th:href="@{/admin}" class="button secondary">← Wróć do panelu</a>
    </div>

    <div th:if="${successMessage}" class="post-status-unpublished" style="background-color:#166534; color:#dcfce7;">
        <span th:text="${successMessage}">Zapisano ustawienia</span>
    </div>

    <form id="settings-form" method="post" th:action="@{/admin/settings}" style="margin-top: 15px;">
        <label for="siteTitle">Tytuł strony (nagłówek H1)</label>
        <input type="text" id="siteTitle" name="siteTitle" th:value="${siteTitle}" required>

        <label for="titleAlign">Wyrównanie tytułu (H1)</label>
        <select id="titleAlign" name="titleAlign">
            <option value="left" th:selected="${siteTitleAlign} == 'left'">Do lewej</option>
            <option value="center" th:selected="${siteTitleAlign} == 'center'">Do środka</option>
            <option value="right" th:selected="${siteTitleAlign} == 'right'">Do prawej</option>
        </select>

        <label for="siteTitleColor">Kolor tytułu (H1)</label>
        <input type="color" id="siteTitleColor" name="siteTitleColor" th:value="${siteTitleColor}">

        <label for="siteTitleSize">Rozmiar tytułu (H1) w pikselach</label>
        <input type="number" id="siteTitleSize" name="siteTitleSize" min="16" max="72" step="1" th:value="${siteTitleSize}">

        <label for="aboutAuthor">Sekcja "O autorze" (HTML, sidebar)</label>
        <textarea id="aboutAuthor" name="aboutAuthor" rows="4" th:text="${aboutAuthor}"></textarea>

        <label for="aboutContent">Strona "O blogu" (HTML treści strony)</label>
        <textarea id="aboutContent" name="aboutContent" rows="8" th:text="${aboutContent}"></textarea>

        <hr style="margin: 25px 0;">

        <h3>Avatar autora</h3>
        <p class="muted" style="font-size: 0.9rem;">Możesz podać URL lub wgrać plik graficzny 80×80, który będzie używany jako zdjęcie autora.</p>

        <div style="display:flex; align-items:center; gap:16px; margin-bottom: 10px;">
            <div style="width:80px; height:80px; border-radius:8px; background:rgba(148,163,184,0.2); border:1px dashed rgba(148,163,184,0.8); display:flex; align-items:center; justify-content:center; overflow:hidden;">
                <!-- Zmieniony podgląd: jeśli brak URL, pokazujemy tekst, jeśli jest URL, pokazujemy obraz -->
                <span th:if="${#strings.isEmpty(authorAvatar)}" style="font-size:0.75rem; color:#94a3b8; text-align:center; padding:4px;">Podgląd</span>
                <img th:if="${!#strings.isEmpty(authorAvatar)}" th:src="${authorAvatar}"
                     alt="Avatar autora" style="width:100%; height:100%; object-fit:cover;">
            </div>
            <div style="flex:1; display:flex; flex-direction:column; gap:6px;">
                <div>
                    <label for="authorAvatar" style="display:block; margin-bottom:4px;">URL avatara</label>
                    <input type="text" id="authorAvatar" name="authorAvatar" th:value="${authorAvatar}" placeholder="np. https://twoj-serwer.pl/avatar.png">
                </div>
                <div>
                    <label for="authorAvatarFile" style="display:block; margin-bottom:4px;">Wgraj plik avatara (opcjonalnie)</label>
                    <input type="file" id="authorAvatarFile" accept="image/*" style="width:100%;">
                    <button type="button" id="upload-author-avatar" class="button secondary" style="margin-top:6px;">Wgraj obrazek i ustaw URL</button>
                    <p class="muted" style="font-size: 0.8rem; margin-top:4px;">Po wgraniu pliku URL zostanie automatycznie wpisany w pole powyżej. Następnie kliknij "Zapisz ustawienia".</p>
                    <!-- Prosty debug: pokaż aktualną wartość URL avatara -->
                    <p class="muted" style="font-size: 0.8rem; margin-top:4px;" th:text="'Aktualny URL avatara: ' + (${#strings.isEmpty(authorAvatar)} ? '[brak]' : authorAvatar)"></p>
                </div>
            </div>
        </div>

        <div class="toolbar" style="margin-top: 15px;">
            <button type="submit">Zapisz ustawienia</button>
        </div>
    </form>
</article>

</body>
</html>
